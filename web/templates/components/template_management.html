<!-- Template Management Section -->
<div class="section">
    <h2>Template Management</h2>
    
    <!-- Add Template -->
    <h3>Create New Template</h3>
    <form method="POST" action="/add_template">
        <div class="form-group">
            <label for="template_name">Template Name:</label>
            <input type="text" id="template_name" name="template_name" required>
        </div>
        
        <!-- Dynamic template builder -->
        <div id="template_builder">
            <label>Text Items:</label>
            <button type="button" class="add-text-item" onclick="addTextItem()">+ Add Text Item</button>
            <div id="text_items_container">
                <div class="text-item" data-index="0">
                    <h4>Text Item 1 <button type="button" class="remove-text-item" onclick="removeTextItem(0)">Remove</button></h4>
                    <div class="two-column">
                        <div>
                            <div class="form-group">
                                <label for="element_type_0">Element Type:</label>
                                <select id="element_type_0" name="element_type_0" required onchange="updateSpecialFields(0, this.value)">
                                    <option value="static">Static Text</option>
                                    <option value="scrolling">Scrolling Text</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Content:</label>
                                <input type="text" name="text_content_0" required>
                            </div>
                            <div class="form-group">
                                <label>X Position:</label>
                                <input type="number" name="text_x_0" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>Y Position:</label>
                                <input type="number" name="text_y_0" value="10" min="0">
                            </div>
                            <div class="form-group">
                                <label>Font Size:</label>
                                <select name="text_font_0">
                                    <option value="4x6">4x6 (Tiny)</option>
                                    <option value="5x7">5x7 (Small)</option>
                                    <option value="5x8">5x8 (Small)</option>
                                    <option value="6x9">6x9 (Medium)</option>
                                    <option value="6x10" selected>6x10 (Medium - Default)</option>
                                    <option value="6x12">6x12 (Medium)</option>
                                    <option value="6x13">6x13 (Medium)</option>
                                    <option value="7x13">7x13 (Large)</option>
                                    <option value="7x14">7x14 (Large)</option>
                                    <option value="8x13">8x13 (Large)</option>
                                    <option value="9x15">9x15 (X-Large)</option>
                                    <option value="9x18">9x18 (X-Large)</option>
                                    <option value="10x20">10x20 (XX-Large)</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>Color:</label>
                                <input type="color" name="text_color_0" value="#ffff00">
                            </div>
                            <div id="special_fields_0" class="template-type-fields" style="display: none;">
                                <!-- Special fields for scrolling/animation will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="template_payload_manual">Or Edit JSON Manually:</label>
            <textarea id="template_payload_manual" name="payload_manual" placeholder='{"type": "static", "text": [{"content": "Hello World", "x": 0, "y": 10, "color": [255, 255, 0]}]}'></textarea>
        </div>
        <button type="submit" class="btn">Create Template</button>
    </form>

    <!-- Templates List -->
    <h3>Existing Templates</h3>
    {% if templates %}
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Payload Preview</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for template in templates %}
                    <tr>
                        <td>{{ template.name }}</td>
                        <td><span class="badge">{{ template.template_type }}</span></td>
                        <td>
                            <code style="font-size: 0.8em;">
                                {{ template.payload[:100] }}{% if template.payload|length > 100 %}...{% endif %}
                            </code>
                        </td>
                        <td>
                            <form method="POST" action="/delete_template/{{ template.id }}" style="display: inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No templates found.</p>
    {% endif %}
</div>